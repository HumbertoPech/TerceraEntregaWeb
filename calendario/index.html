<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="js/jquery.min.js"></script>
    <script src="js/moment.min.js"></script>
    <link rel="stylesheet" href="css/fullcalendar.min.css">
    <link rel="stylesheet" href="css/mymodal.css">
    <script src="js/fullcalendar.min.js"></script>
    <script src="js/es.js"></script>
    <style>
        #CalendarioWeb {
            width: 50%;
            height: 50%;
        }
    </style>
</head>
<body>
    <!--Centrarlo con los cols -->
    <div id = "CalendarioWeb"></div>

    <!--button for the modal-->
    <button id="myBtn">Open Modal</button>

    <!-- The Modal  for modify, add or eliminate-->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
        <div class="modal-header">
          <span class="close">&times;</span>
          <h2>Evento</h2>
          <h4 id="tituloEvento"></h4>
        </div>
        <div class="modal-body">
            <input type="hidden" id="txtID"  name="txtID"/>
            Fecha: <input type="text" disabled id="txtFecha" name = "txtFecha"/><br/>
            Titulo: <input type="text" id="txtTitulo" placeholder="Titulo del evento"/><br/>
            Hora: <input type ="datetime" id="txtHora" value = "10:30"/><br/>
            Descripcion: <textarea id = "txtDescripcion" rows = "3" placeholder="Descripción del evento"></textarea><br/>
            Color:<input type="color" value="#ff0000" id ="txtColor" style="height:36px;" ><br/>
          
        </div>
        <div class="modal-footer">
          <h3>Modal Footer</h3>
          <button type="button" id="btnAgregar">Agregar</button>
          <button type="button" id="btnModificar">Modificar</button>
          <button type="button" id="btnBorrar">Borrar</button>
          <button type="button" id="btnCancelar">Cancelar</button>
        </div>
      </div>

    </div>

    <script>
        $(document).ready(function(){
            $('#CalendarioWeb').fullCalendar({
                dayClick:function(date, jsEvent, view){
                    $('#btnAgregar').prop("disable", false);
                    $('#btnModificar').prop("disable", true);
                    $('#btnBorrar').prop("disable", true);
                    limpiarFormulario();
                    //$('#txtDescripcion').val("");
                    //$('#txtID').val("");
                    //$('#txtTitulo').val("");
                    //$('#txtColor').val("");
                    //alert("Valor Seleccionado:" + date.format());
                    //alert("Vista actual: " + view.name);
                    //$(this).css('background-color','red');
                    //$('#myModal').style.display = "none";
                    
                    $('#txtFecha').val(date.format());
                    document.getElementById('myModal').style.display = "block";
                },
                        events: 'eventos.php',/*[
                        {
                            title:'Evento 1: prueba',
                            descripcion:"Esto es una descripcion!",
                            start: '2018-10-15',
                            color: "black",
                            textColor: "yellow"
                        },
                        {
                            title: 'Eventro 2: prueba',
                            descripcion:"Esto es una descripcion!",
                            start: '2018-10-15',
                            end: '2018-10-26'
                        },
                        {
                            title: 'Eventro 3: prueba',
                            descripcion:"XD",
                            start: '2018-10-15T12:30:00',
                            allDay:  false
                        }
                        ]*/
                        
                eventClick:function(calEvent,jsEvent, view){
                    $('#btnAgregar').prop("disable", true);
                    $('#btnModificar').prop("disable", false);
                    $('#btnBorrar').prop("disable", false);
                    $('#tituloEvento').html(calEvent.title);
                    $('#txtDescripcion').val(calEvent.descripcion);
                    $('#txtID').val(calEvent.id);
                    $('#txtTitulo').val(calEvent.title);
                    $('#txtColor').val(calEvent.color);
                    FechaHora =calEvent.start._i.split(" ");
                    $('#txtFecha').val(FechaHora[0]);
                    $('#txtHora').val(FechaHora[1]);
                    document.getElementById('myModal').style.display = "block";
                }
                
            });
        });

    </script>

    <script>
        /*
        function onclick(){
            var m = document.getElementById('myModal');
            m.style.display = "block";
        }*/
        // Get the modal
    var modal = document.getElementById('myModal');

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks on the button, open the modal 
    btn.onclick = function() {
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    </script>

    <script>
        var NuevoEvento;
        $('#btnAgregar').click(function(){
            RecolectarDatos();
            EnviarInformacion('agregar', NuevoEvento);
            
        });
        $('#btnBorrar').click(function(){
            RecolectarDatos();
            EnviarInformacion('eliminar', NuevoEvento);
            
        });
        $('#btnModificar').click(function(){
            RecolectarDatos();
            EnviarInformacion('modificar', NuevoEvento);
            
        });

        function RecolectarDatos(){
            NuevoEvento = {
                id:$('#txtID').val(),
                title:$('#txtTitulo').val(),
                start:$('#txtFecha').val() + " "+ $('#txtHora').val(),
                color:$('#txtColor').val(),
                descripcion:$('#txtDescripcion').val(),
                textColor:"#FFFFFF",
                end:$('#txtFecha').val() + " "+ $('#txtHora').val()
            };
        }

        function EnviarInformacion(accion, objEvento){
            $.ajax({
                type:'POST',
                url:'eventos.php?accion='+accion,
                data:objEvento,
                success:function(msg){
                    if(msg){
                        alert("Acción realizada con éxito.");
                        $('#CalendarioWeb').fullCalendar('refetchEvents');
                        document.getElementById('myModal').style.display = "none";
                    }else{
                        alert("Ocurrió un problema al querer realizar cambios en la base de datos");
                    }
                },
                error:function(){
                    alert("Hay un error");
                }
            });
        }

        function limpiarFormulario(){
            $('#txtDescripcion').val('');
            $('#txtID').val('');
            $('#txtTitulo').val('');
            $('#txtColor').val('');
        }

    </script>
</body>
</html>